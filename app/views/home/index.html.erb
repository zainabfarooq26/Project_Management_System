<div class="container-fluid">
  <nav class="navbar navbar-expand-lg bg-light shadow-sm">
    <div class="container">
      <a class="navbar-brand" href="/">
       
        </ul>
        <form class="d-flex">
          <% if user_signed_in? %>
            <!-- Profile Picture as a Button (Trigger Modal) -->
            <div class="d-flex align-items-center">
              <% if current_user.profile_photo.attached? %>
                <%= link_to '#', class: "btn btn-light rounded-circle p-0 profile-btn", data: { bs_toggle: "modal", bs_target: "#profileDetailsModal" } do %>
                  <%= image_tag(current_user.profile_photo, class: "rounded-circle", width: 40, height: 40) %>
                <% end %>
              <% else %>
                <%= link_to '#', class: "btn btn-light rounded-circle p-0 profile-btn", data: { bs_toggle: "modal", bs_target: "#profileDetailsModal" } do %>
                  <%= image_tag("default-avatar.png", class: "rounded-circle", width: 40, height: 40) %>
                <% end %>
              <% end %>
            </div>
            <!-- Sign Out Button -->
            <%= link_to "Sign Out", destroy_user_session_path, data: { turbo_method: :delete }, class: "btn btn-outline-warning ms-2" %>
          <% else %>
            <!-- Sign Up and Login Links -->
            <%= link_to "Sign Up", new_user_registration_path, class: "btn btn-outline-primary me-2" %>
            <%= link_to "Login", new_user_session_path, class: "btn btn-outline-success" %>
          <% end %>
        </form>
      </div>
    </div>
  </nav>
</div>

<!-- Profile Modal -->
<div class="modal fade" id="profileDetailsModal" tabindex="-1" aria-labelledby="profileDetailsModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="profileDetailsModalLabel">Profile Details</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <!-- Profile Info -->
        <div class="card shadow-sm border-light">
              <div class="card-body text-center">
                <% if current_user.profile.profile_photo.attached? %>
                  <%= image_tag current_user.profile.profile_photo, class: "rounded-circle mb-3", width: 120, height: 120 %>
                <% else %>
                  <%= image_tag "default-avatar.png", class: "rounded-circle mb-3", width: 120, height: 120 %>
                <% end %>
            <h5 class="card-title font-weight-bold text-dark">
              <%= current_user.profile.first_name %> <%= current_user.profile.last_name %>
            </h5>

            <p class="card-text text-muted">
              <strong>Email:</strong> <%= current_user.email %>
            </p>

            <p class="card-text">
              <strong>Role:</strong>
              <% if current_user.admin? %>
                <span class="badge bg-danger">Admin</span>
              <% elsif current_user.manager? %>
                <span class="badge bg-warning text-dark">Manager</span>
              <% else %>
                <span class="badge bg-secondary">User</span>
              <% end %>
            </p>

            <!-- Edit Profile Button -->
            <%= link_to 'Edit Profile', edit_profile_path(current_user.profile), class: "btn btn-primary mt-3 px-4" %>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

    

<!-- Include Bootstrap's JS for Modal Functionality -->
<%= javascript_include_tag "https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js", integrity: "sha384-k6RqeWeci5ZR/Lv4MR0sA6A57eegAwrjANPrc6wF/qFV7bE0JH07hPH2oTQZ7OYt", crossorigin: "anonymous" %>

<div class="container mt-4">
  <div class="row">
    <!-- Top 5 Projects -->
    <div class="col-md-6">
      <h4>Top 5 Projects</h4>
      <table class="table table-bordered">
        <thead class="table-success">
          <tr>
            <th>Project</th>
            <th>Hours Clocked</th>
            <th>Earnings</th>
          </tr>
        </thead>
        <tbody>
          <% @top_projects.each do |project| %>
            <tr>
              <td><%= project.title %></td>
              <td><%= project.time_logs.sum(:hours) %></td>
              <td>$<%= project.total_earnings %></td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>

    <!-- Bottom 5 Projects -->
    <div class="col-md-6">
      <h4>Bottom 5 Projects</h4>
      <table class="table table-bordered">
        <thead class="table-danger">
          <tr>
            <th>Project</th>
            <th>Hours Clocked</th>
            <th>Earnings</th>
          </tr>
        </thead>
        <tbody>
          <% @bottom_projects.each do |project| %>
            <tr>
              <td><%= project.title %></td>
              <td><%= project.time_logs.sum(:hours) %></td>
              <td>$<%= project.total_earnings %></td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Earnings and Hours Chart -->
  <div class="row mt-4">
    <div class="col-md-12">
      <h4>Monthly Earnings & Hours Logged</h4>
      <canvas id="earningsChart"></canvas>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", function() {
    const ctx = document.getElementById('earningsChart').getContext('2d');
    new Chart(ctx, {
      type: 'line',
      data: {
        labels: <%= @monthly_earnings.keys.map { |date| date.strftime("%b %Y") }.to_json.html_safe %>,
        datasets: [
          {
            label: 'Earnings ($)',
            data: <%= @monthly_earnings.values.to_json.html_safe %>,
            borderColor: 'blue',
            fill: false
          },
          {
            label: 'Hours Logged',
            data: <%= @monthly_hours.values.to_json.html_safe %>,
            borderColor: 'green',
            fill: false
          }
        ]
      }
    });
  });
</script>

