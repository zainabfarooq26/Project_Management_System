<nav class="navbar navbar-expand-lg navbar-dark bg-dark mb-4">
  <div class="container-fluid">
    <a class="navbar-brand" href="#">Projects Dashboard</a>
    <div class="d-flex align-items-center">
      <!-- Profile Button (Triggers Modal) -->
      <button class="btn btn-outline-light me-2" data-bs-toggle="modal" data-bs-target="#profileDetailsModal">
        <i class="bi bi-person-circle"></i> Profile
      </button>
      
      <% if current_user.is_manager? %>
        <%= link_to "New Project", new_manager_client_project_path(@client), class: "btn btn-outline-light me-3" %>
      <% end %>
      
      <% if current_user && !current_user.admin? && !current_user.is_manager? %>
        <%= link_to "Assigned Projects", assignedprojects_manager_client_projects_path(@client), class: "btn btn-outline-light me-3" %>
      <% end %>
      
      <!-- Sign-Out Button -->
      <%= button_to 'Sign Out', destroy_user_session_path, method: :delete, class: 'btn btn-outline-light me-3' %>
    </div>
  </div>
</nav>

<!-- Include the Profile Modal -->
<%= render 'shared/profile_modal' %>

<div class="d-flex justify-content-between align-items-center mb-3">
  <h2><i class="bi bi-kanban"></i> Projects Listing</h2>

  <%= form_tag manager_client_projects_path(@client), method: :get, class: "ms-auto me-3 w-50" do %>
    <div class="input-group">
      <!-- Category Dropdown -->
      <select name="search_category" class="form-select" style="max-width: 180px;">
        <option value="">All Categories</option>
        <option value="title">Project Title</option>
        <option value="user">Assigned User</option>
      
      </select>
      
      <!-- Search Input -->
      <%= text_field_tag :search_query, params[:search_query], class: "form-control", placeholder: "Search..." %>
      
      <!-- Search Button -->
      <button type="submit" class="btn btn-dark">
        <i class="fas fa-search text-white"></i>
      </button>
    </div>
  <% end %>
</div>
 <% if current_user.is_manager? %>
<div class="d-flex justify-content-center my-3">
  <%= link_to "Highest Paid", manager_client_projects_path(@client, search_category: params[:search_category], search_query: params[:search_query], sort: "highest_paid"), 
    class: "btn btn-outline-dark me-2 #{'active' if params[:sort] == 'highest_paid'}" %>
  <%= link_to "Lowest Paid", manager_client_projects_path(@client, search_category: params[:search_category], search_query: params[:search_query], sort: "lowest_paid"), 
    class: "btn btn-outline-dark #{'active' if params[:sort] == 'lowest_paid'}" %>
</div>
<%end%>

<!-- Project Table -->
<div class="table-responsive">
  <table class="table table-striped table-bordered align-middle">
    <thead class="table-dark">
      <tr>
        <th>Title</th>
        <th>Description</th>
        <th>Attachments</th>
        <th>Users Assigned</th>
        <% unless current_user.is_manager? %>
          <th>Comments</th>
          <th>Time Logs</th>
        <% end %>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <% if @projects.present? %>
        <% @projects.each do |project| %>
          <tr>
            <td><strong><%= project.title %></strong></td>
            <td><%= project.description.truncate(100) %></td>
            <td>
              <% if project.attachments.attached? %>
                <ul class="list-unstyled">
                  <% project.attachments.each do |attachment| %>
                    <li>
                      <i class="bi bi-file-earmark-arrow-down"></i> 
                      <%= link_to attachment.filename, rails_blob_path(attachment, disposition: "attachment"), class: "btn btn-link" %>
                    </li>
                  <% end %>
                </ul>
              <% else %>
                <span class="text-muted">No attachments</span>
              <% end %>
            </td>
            <td>
              <% if project.users.any? %>
                <ul class="list-unstyled">
                  <% project.users.each do |user| %>
                    <li>
                      <i class="bi bi-person-circle"></i> <%= user.first_name %> <%= user.last_name %> (<%= user.email %>)
                    </li>
                  <% end %>
                </ul>
              <% else %>
                <span class="text-muted">No users assigned</span>
              <% end %>
            </td>

            <% unless current_user.is_manager? %>
              <td><span class="text-muted">Comments Placeholder</span></td>
              <td><span class="text-muted">Time Logs Placeholder</span></td>
            <% end %>

            <td>
              <%= link_to "Show", manager_client_project_path(project.client, project), class: "btn btn-success btn-sm" %>
              <% if current_user.is_manager? %>
                <%= link_to "Edit", edit_manager_client_project_path(project.client, project), class: "btn btn-warning btn-sm" %>
                <%= link_to "Delete", manager_client_project_path(project.client, project), data: { turbo_method: :delete, turbo_confirm: "Are you sure?" }, class: "btn btn-danger btn-sm" %>
                <%= link_to "View Payments", manager_client_project_payments_path(project.client, project), class: "btn btn-primary btn-sm" %>
                <%= link_to "Assign Users", assign_users_manager_client_project_path(project.client, project), class: "btn btn-info btn-sm" %>
              <% end %>
            </td>
          </tr>
        <% end %>
      <% else %>
        <tr>
          <td colspan="7" class="text-center">No projects available</td>
        </tr>
      <% end %>
    </tbody>
  </table>
</div>